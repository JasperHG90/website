---
title: "Shiny server series part 1: setting up"
layout: post
date: "2017-04-09T17:46:00"
categories: ["tutorial"]
tag: ["R", "shiny", "shiny server", "rstudio server"]
author: Jasper Ginn
blog: true
description: Recently, I've set up several shiny servers that required some custom tweaks like user authentication, running shiny server on multiple ports and setting up SSL. With the help of numerous resources, I got everything running smoothly. I decided to publish these steps on my blog so that others might also use them.
---

*This guide is part of a series on setting up your own private server running shiny apps. There are many guides with great advice on how to set up an R shiny server and related software. I try to make a comprehensive guide based in part on these resources as well as my own experiences. I always aim to properly attribute information to their respective sources. If you notice an issue, please contact me.*

*[Part 2](https://www.jasperginn.nl/shiny-server-series-pt2/) is now available!*

*[Part 3](https://www.jasperginn.nl/shiny-server-series-pt3/) is now available!*

Welcome to the first part of the shiny server series!

Recently, I've set up several shiny servers that required some custom tweaks like user authentication, running shiny server on multiple ports and setting up SSL. With the help of numerous resources, I got everything running smoothly. I decided to publish these steps on my blog so that others might also use them. In this first part, we’ll be setting up the private server and installing shiny.

## Resources used for this part
This guide draws from other guides on the web. The resources below were used to put together this resource.

1. [This guide](https://www.digitalocean.com/community/tutorials/how-to-install-r-on-ubuntu-16-04-2) shows you how to install R on Ubuntu 16.04
2. Dean Attali's [blog post](http://deanattali.com/2015/05/09/setup-rstudio-shiny-server-digital-ocean/) is one of the best and most comprehensive guides on setting up your own shiny server.
3. [This guide](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-host-name-with-digitalocean) is used to couple a domain name to your server.

## What you’ll need
In order to complete this entire series, I expect you have access to the following:

- A Virtual Private Server (VPS, see below)
- A domain name, such as www.iamadomainname.com. These are available on e.g. [namecheap](www.namecheap.com).

If you have these two things, you may proceed!

## A VP…What?
A [Virtual Private Server (VPS)](https://en.wikipedia.org/wiki/Virtual_private_server) is a service that you can purchase from providers such as DigitalOcean, Amazon AWS and Google Cloud Services. Instead of buying a physical server and planting it in your home somewhere, you rent a small portion of a server from a provider that looks like a normal server environment: you have your own OS and you can manage your own users and so on.  

In this guide, I’ll be using DigitalOcean, but you can use any VPS from any provider as long as it runs on Ubuntu 16.04 and has at least 512MB RAM and one processor.  You can use [this link](https://m.do.co/c/2e2a784a04cd) to sign up to DigitalOcean if you don't have an account already. Bonus: you’ll receive $10 in credit.

## Setting up a VPS on DigitalOcean
After signing up to DO, you will see the following screen

![](img/blog/shiny_series_pt1/1_createdroplet.png)

There won’t be much going on here … yet! Click on ‘create droplet’ to set up your VPS. The options are relatively straightforward here. You want to select a Ubuntu 16.04 distribution.

![](img/blog/shiny_series_pt1/2_selectimage.png)

Then, you can decide how much power your droplet will have. I chose the smallest version, which works perfectly fine, but feel free to take a bigger size if you like.

![](img/blog/shiny_series_pt1/3_selectsize.png)

Select an appropriate data centre (usually that means choosing one in or near your own country)

![](img/blog/shiny_series_pt1/4_selectdatacenter.png)

The final set of options can look arcane if you’re not used to them. Fortunately, the only option you really need to pay attention to is the [SSH key](https://en.wikipedia.org/wiki/Secure_Shell).   

![](img/blog/shiny_series_pt1/5_selectoptions.png)

An SSH key functions as a unique identifier for you, the owner of the VPS, and adds a layer of security to your server.  DigitalOcean provides a tutorial for [Windows users](https://www.digitalocean.com/community/tutorials/how-to-use-ssh-keys-with-putty-on-digitalocean-droplets-windows-users) and [Unix](https://www.digitalocean.com/community/tutorials/how-to-use-ssh-keys-with-digitalocean-droplets) users on their website. This step is optional: you don’t have to do it, but I strongly recommend it.

After you’ve sorted out SSH access, you can choose a suitable name for your droplet and press ‘create’.

Congratulations! You are now the proud owner of your own VPS.

## Accessing your server and setting up shiny
Click on ‘droplets’ at the top right of the DO menu. Copy the IP address of your droplet and open up a terminal  or PuTTY. Log into your server:

```shell
ssh root@<ip-address>
```

### Setting up a user
Since we don’t want to rely on the root user too much, we’ll create a new user called ‘shiny’. When you are prompted to enter a name, office number etc. you can just hit enter:

```shell
adduser shiny
```

Next, we give the shiny user admin rights and switch to the shiny user:

```shell
# Give shiny admin rights
gpasswd -a shiny sudo
# Switch to shiny user
su shiny
```

### Installing dependencies
Firstly, update the list of packages:

```shell
sudo apt-get update
```

Then add the CRAN repository to this list (copy these commands one by one):

```shell
# Add a trusted key
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
# Add the CRAN repo
sudo add-apt-repository 'deb [arch=amd64,i386] https://cran.rstudio.com/bin/linux/ubuntu xenial/'
# Update the list again
sudo apt-get update
```

If your droplet has 1G of RAM or less, we need to set up some swap space. This will allow the server to use hard-drive space as additional RAM when it needs to:

```shell
# Set up swap
sudo /bin/dd if=/dev/zero of=/var/swap.1 bs=1M count=1024
sudo /sbin/mkswap /var/swap.1
sudo /sbin/swapon /var/swap.1
sudo sh -c 'echo "/var/swap.1 swap swap defaults 0 0 " >> /etc/fstab'
```

Now, we’re ready to install R and other dependencies for shiny server:

```shell
# Install R
sudo apt-get -y install r-base r-base-dev
# Install shiny server dependencies
sudo apt-get -y install libapparmor1 gdebi-core
# These are used by R libraries
sudo apt-get install -y libxml2-dev libcurl4-openssl-dev libssl-dev
```

Copy and execute the following lines to install these R packages:

```shell
# Install shiny
sudo su - -c "R -e \"install.packages('shiny', repos='http://cran.rstudio.com/')\""
# Install devtools
sudo su - -c "R -e \"install.packages('devtools', repos='http://cran.rstudio.com/')\""
# Install digest
sudo su - -c "R -e \"install.packages('digest', repos='http://cran.rstudio.com/')\""
```

Now we’re ready to install shiny server:

```shell
# Download rstudio server:
wget https://download2.rstudio.org/rstudio-server-1.0.136-amd64.deb
# Download shiny server:
wget https://download3.rstudio.org/ubuntu-12.04/x86_64/shiny-server-1.5.1.834-amd64.deb
# Install
sudo gdebi rstudio-server-1.0.136-amd64.deb
sudo gdebi shiny-server-1.5.1.834-amd64.deb
```

The rstudio and shiny server are now accessible on ports 8787 and 3838. You can access them by navigating to `<your-ip-address>:8787` in a browser.

While this is fine, it’s a bit difficult to remember and not ideal for sharing. This is easily solvable! We can simply point a domain name to our new server.

## Pointing a domain name to your server
This step involves two actions: one from the provider you bought the domain name from, and one on the DO dashboard.

### Changing name servers
The first thing we’ll do is to change the name servers of your domain name so that they point to the DO name servers. Most providers will give this option and the process is largely the same. I’ll be using my namecheap account for this exercise. If you're using another provider, a simple google search for 'change nameservers <provider>' should give you the requisite information.

Once you are logged into your namecheap account, you will see the following screen:

![](img/blog/shiny_series_pt1/NC_fig1.png)

Click on the ‘manage’ button for the domain name you want to use. You will now see the following screen:

![](img/blog/shiny_series_pt1/NC_fig2.png)

Click on the arrow (surrounded by green box) and select ‘custom DNS’ (surrounded by blue box).  Add the DO name servers as shown in the image below:

![](img/blog/shiny_series_pt1/namecheap2.png)

Save your changes and close the tab.

### Setting up A and CNAME records on DigitalOcean
In your DO dashboard, click on the ‘networking’ option

![](img/blog/shiny_series_pt1/DO_networking_fig1.png)

Enter your domain name (without ‘www’) and click ‘add domain’

![](img/blog/shiny_series_pt1/DO_networking_fig2.png)

We’re going to add one A-record and two CNAME records. Firstly,  add ‘@’ under the hostname as in the image below, select your VPS from the drop-down list and click ‘Create Record’:

![](img/blog/shiny_series_pt1/3_DO_networking.png)

Next, create a CNAME record. Under ‘hostname’ enter ‘\*’, and under ‘is an alias of’, enter ‘@‘, as shown in the picture below:

![](img/blog/shiny_series_pt1/4_DO_networking.png)

Next, create another CNAME record where you input ‘www’ under ‘hostname’ and ‘@’ under ‘is an alias of’:

![](img/blog/shiny_series_pt1/5_DO_networking.png)

The entire setup should look like the image below

![](img/blog/shiny_series_pt1/6_DO_networking.png)

You are now done setting up your domain name. It can take up to 24 hours before your domain name points to your server, but usually this takes less than several hours.

### Configuring nginx on your server
OK. So now your server can be accessed using a custom domain name. This is great, but rstudio and shiny server are still only accessible using the ports on which they are hosted. We’ll now set up [Nginx](https://en.wikipedia.org/wiki/Nginx) on your server to manage the routes to the shiny and studio servers.

Go back to the terminal where you’re logged into the server, and execute the following:

```shell
sudo apt-get -y install nginx
```

Now, make a backup of the nginx configuration:

```shell
sudo cp /etc/nginx/sites-enabled/default /etc/nginx/sites-enabled/default-backup
```

Open up the configuration file

```shell
sudo nano /etc/nginx/sites-enabled/default
```

Add ‘localhost’ to the server name (green box in the image below).

![](img/blog/shiny_series_pt1/1_nginx.png)

Then, copy the following lines to the config file and paste them in the location shown in the image (area surrounded by pink box). Make sure the indentation of the lines looks like the picture above. Do not use tabs, only spaces!

```text
location /apps/ {
        proxy_pass http://127.0.0.1:3838/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
}

location /editor/ {
        proxy_pass http://127.0.0.1:8787/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
}
```

Hit `control+x` and then `Y` and `enter` and your changes will be saved. Your rstudio and shiny servers are now accessible using e.g. `www.<your-domain-name>.<extension>/apps`

## Adding shiny applications
The easiest way to add shiny applications is to create a github or bitbucket repository for the shiny application, which you then clone in the shiny server folder. We first we need to set up user rights for our shiny user.

### Setting up permissions
Navigate to the shiny server directory where the apps live:

```shell
cd /srv/shiny-server
```

Then, give the shiny user read/write permissions:

```shell
sudo groupadd shiny-apps
sudo usermod -aG shiny-apps shiny
sudo chown -R shiny:shiny-apps .
sudo chmod g+w .
sudo chmod g+s .
```

### Example: hosting an application
This part shows how you can store your shiny apps on github and host them on your server.

Sign up for a github account if you have not already. You can also choose to use bitbucket: the process is largely the same.

Create a repository

![](img/blog/shiny_series_pt1/1_GH.png)

Follow the steps on the next screen to add files to your repository

![](img/blog/shiny_series_pt1/3_GH.png)

When you’ve pushed your server.R and ui.R files, it should look like this

![](img/blog/shiny_series_pt1/2_GH.png)

You can now clone this repository in your server by clicking the ‘clone or download’ button (surrounded by the pink box). Copy the url and go back to the terminal where you are logged into your server. Then, execute the following commands:

```shell
# Navigate to the folder with shiny applications
cd /srv/shiny-server
# Clone the repository
git clone https://github.com/JasperHG90/TenK-example.git
# Install dependencies
sudo su - -c "R -e \"devtools::install_github('JasperHG90/TenK')\""
```

You can now visit the shiny application by navigating to `www.<your-domain-name>.<extension>/apps/TenK-example` in a browser.

###  Some notes on installing R packages
When installing R packages, it’s best to use the following code:

```shell
sudo su - -c "R -e \"install.packages('<package-name>', repos='http://cran.rstudio.com/')\""
```

This ensures that packages are installed globally and that every user has access to it.

#### Using packrat
You can use packrat - a package management system authored by rstudio - for shiny applications. Packrat is quite useful because it creates a local repository (with, for example, specific package versions) of packages. The advantage of this approach is that it improves the portability of the application and ensures that apps that use the same dependencies but, for example, different versions of that dependency can easily run on the same system. On the flip side, it does not work very well with certain specific libraries such as rgdal.  You can read more about packrat on [this page](https://rstudio.github.io/packrat/).

##### Setting up packrat
Setting up packrat is easy. In rstudio, start a new project (or open an existing one).

![](img/blog/shiny_series_pt1/1_packrat.png)

Go to the packrat section and check the box

![](img/blog/shiny_series_pt1/2_packrat.png)

Packrat will now make a local repository with necessary packages. This can take a while.

![](img/blog/shiny_series_pt1/3_packrat.png)

Don’t forget to [push](https://help.github.com/articles/adding-a-file-to-a-repository-using-the-command-line/) these changes to your github repository.

##### Cloning the repo and restoring the library
Adding shiny apps with a packrat library is similar to the process outlined above.

First, install the packrat package:

```shell
sudo su - -c "R -e \"install.packages('packrat', repos='http://cran.rstudio.com/')\""
```

Navigate to the `/srv/shiny-server` folder and clone the repository:

```shell
# Navigate to the folder
cd /srv/shiny-server
# Clone the repo
git clone https://github.com/JasperHG90/tenk-example-2.git
```

Enter the repository and start an R session:

```shell
# Enter the folder
cd tenk-example-2
# Start an R session
R
```

Packrat should automatically kick in and start installing packages. If it doesn’t, execute the following:

```R
packrat::restore()
```

![](img/blog/shiny_series_pt1/4_packrat.png)

Execute `q()` to quit the R session

## Future content in this series
This wraps up the first part of the shiny server series. You now have a VPS with a custom domain name running rstudio server and shiny server. This setup forms the basis on which the next installments in this series build.

Subsequent parts in this series will focus on the following topics

### Part 2: running shiny server on multiple ports
We’ll run shiny server on multiple ports so that we have one server to host public shiny apps and another server to host private apps for a select group of people. We’ll add user authentication to this private server in part 4 of this series.

### Part 3: adding an SSL security certificate
Before we can add user authentication to shiny, we want to set up an SSL certificate to buff security on our server. This encrypts traffic from and to your server.

### Part 4: adding user authentication to your server using Auth0
In this part, we’ll use Auth0, a free service for up to 7.000 users, to add authentication to our shiny server running private applications. To this end, we’ll slightly adapt the excellent [Auth0 tutorial](https://auth0.com/blog/adding-authentication-to-shiny-server/) to work with our setup.

### Part 5: hosting a static website on your server
Most websites have a front end and a back end. The front end is what you see when you visit a page. The back end usually consists of one or more databases and services such as user authentication. Conversely, a [static website](https://en.wikipedia.org/wiki/Static_web_page)  is simply a front end: you pre-compile all necessary materials before hosting it on a server. Static websites do not require databases and are typically fast to load. Examples of services that help you make static websites are [Jekyll](https://jekyllrb.com) and [Pelican](https://blog.getpelican.com), to name a few.

You can use the GitHub approach outlined above for shiny applications for static websites as well. You create a repository, upload the static website, and then clone it in the directory from which nginx hosts its example page.
